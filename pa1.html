<!DOCTYPE html>



  


<html class="theme-next pisces use-motion" lang="zh-cn">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="QMXGTetPtY10hIHSHNqZFD20H9EceEjIPzNLP6-sjPA" />








  <meta name="baidu-site-verification" content="p3JCUmfhZh" />







  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.3" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.3">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.3">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.3" color="#222">


  <link rel="manifest" href="/images/manifest.json">


  <meta name="msapplication-config" content="/images/browserconfig.xml" />



  <meta name="keywords" content="code," />










<meta name="description" content="洞察世界的视点 - 简易调试器">
<meta name="keywords" content="code">
<meta property="og:type" content="article">
<meta property="og:title" content="有趣的 PA1">
<meta property="og:url" content="https://blog.nightmare.xin/pa1.html">
<meta property="og:site_name" content="kur0mi&#39;s blog">
<meta property="og:description" content="洞察世界的视点 - 简易调试器">
<meta property="og:locale" content="zh-cn">
<meta property="og:image" content="http://store.nightmare.xin/bd79f5e364df29846a63f87f72111865.png">
<meta property="og:image" content="http://store.nightmare.xin/6804c0b9bfd9fae2f1b5aee2fc5d5e3f.png">
<meta property="og:image" content="http://store.nightmare.xin/6ebc49e16f7398b57a38d1d15a13055d.png">
<meta property="og:updated_time" content="2018-01-24T08:02:03.111Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="有趣的 PA1">
<meta name="twitter:description" content="洞察世界的视点 - 简易调试器">
<meta name="twitter:image" content="http://store.nightmare.xin/bd79f5e364df29846a63f87f72111865.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.3',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'kur0mi'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://blog.nightmare.xin/pa1.html"/>





  <title>有趣的 PA1 | kur0mi's blog</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-cn">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">kur0mi's blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">faith and brave</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-navicon"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-list"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-pie-chart"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://blog.nightmare.xin/pa1.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kur0mi">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/yoshino.bmp">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="kur0mi's blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">有趣的 PA1</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-01-23T17:58:18+08:00">
                2018-01-23
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/PAs/" itemprop="url" rel="index">
                    <span itemprop="name">PAs</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          
              <div class="post-description">
                  洞察世界的视点 - 简易调试器
              </div>
          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="PA1-洞察世界的视点-简易调试器"><a href="#PA1-洞察世界的视点-简易调试器" class="headerlink" title="PA1 - 洞察世界的视点: 简易调试器"></a>PA1 - 洞察世界的视点: 简易调试器</h1><h1 id="在开始愉快的PA之旅之前"><a href="#在开始愉快的PA之旅之前" class="headerlink" title="在开始愉快的PA之旅之前"></a>在开始愉快的PA之旅之前</h1><p>直接运行在硬件上的是操作系统，操作系统向上层提供接口，前人将这些接口进一步封装成为库，而我们则使用这些库来编写程序，它们最终还是运行在硬件上。</p>
<p>PA 要实现一个模拟器，即NEMU (n emulator)，用软件模拟硬件（数组模拟内存，结构体模拟寄存器），模拟器运行在操作系统上，对上层开放接口，这些接口就是它模拟的各种硬件，接下来，应该是在这层’硬件’的上边，进一步开放接口使用户程序能够调用，就像操作系统一样。</p>
<p>其中 PA1 的内容是第一步，模拟各种硬件。（简易调试器应该属于开发环境吧。。）</p>
<h1 id="RTFSC"><a href="#RTFSC" class="headerlink" title="RTFSC"></a>RTFSC</h1><p>RTFSC（即 read the fxxk source code），这是 NEMU 的结构，有计时器，键盘还有各种IO。</p>
<p>CPU，内存，设备构成模拟硬件，监视器则独立于系统外。</p>
<p><img src="http://store.nightmare.xin/bd79f5e364df29846a63f87f72111865.png" alt=""></p>
<p>不过我们在 PA1 中不用了解这么多，基本只需要关注监视器（monitor）相关内容就好了，为什么说基本呢，因为编写监视器要调用其他部分的接口啊。。（如图 我的 merge）</p>
<p><img src="http://store.nightmare.xin/6804c0b9bfd9fae2f1b5aee2fc5d5e3f.png" alt=""></p>
<p>具体各部分内容自己探索好了，RTFSC。</p>
<p>在 main 函数中就两个函数，简单明了。init_monitor 进行了一些准备工作（测试各部分是否正常和一些初始化），ui_mainloop 是一个循环，重复 取指，译码，执行，更新eip 的过程，就像真实的计算机一样。</p>
<p>计算机加电之后将控制权交给 BIOS， BIOS 进行一些检查和简单的初始化，然后会唤醒操作系统，至此 BIOS 的使命就完成了。NEMU 将一段程序加载到 0x100000 处，用于模拟 BIOS启动。</p>
<h1 id="简易调试器"><a href="#简易调试器" class="headerlink" title="简易调试器"></a>简易调试器</h1><ul>
<li><h2 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h2>NEMU 有四个32位的通用寄存器，即eax（累加器），ebx（基数寄存器），ecx（计数器），edx（用于除法）。这些通用寄存器都可以拆分成16位的寄存器使用，即ax，bx，cx，dx，方便读写双字和字，同时兼容16位的处理器。进一步可以拆分成… 还是看图吧</li>
</ul>
<p><img src="http://store.nightmare.xin/6ebc49e16f7398b57a38d1d15a13055d.png" alt=""></p>
<p>esi（源地址），edi（目标地址），esp（指向栈顶），从栈顶访问元素很不方便因此引入 ebp（基地址）。</p>
<p>eip 是指令寄存器，每次执行完指令都要刷新（加上该指令的长度），如果是相对跳转指令还要加上偏移量，绝对跳转则直接转向目标地址。</p>
<p>然后实现寄存器的结构体就好了，记得匿名 union</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"><span class="deletion">-typedef struct &#123;</span></div><div class="line"><span class="deletion">-  struct &#123;</span></div><div class="line"><span class="addition">+typedef union &#123;</span></div><div class="line"><span class="addition">+  union &#123;</span></div><div class="line">     uint32_t _32;</div><div class="line">     uint16_t _16;</div><div class="line">     uint8_t _8[2];</div><div class="line">@@ -26,9 +26,10 @@ typedef struct &#123;</div><div class="line">   /* In NEMU, rtlreg_t is exactly uint32_t. This makes RTL instructions</div><div class="line">    * in PA2 able to directly access these registers.</div><div class="line">    */</div><div class="line"><span class="deletion">-  rtlreg_t eax, ecx, edx, ebx, esp, ebp, esi, edi;</span></div><div class="line"><span class="deletion">-</span></div><div class="line"><span class="deletion">-  vaddr_t eip;</span></div><div class="line"><span class="addition">+  struct &#123;</span></div><div class="line"><span class="addition">+  	rtlreg_t eax, ecx, edx, ebx, esp, ebp, esi, edi;</span></div><div class="line"><span class="addition">+  	vaddr_t eip;</span></div><div class="line"><span class="addition">+  &#125;;</span></div><div class="line"></div><div class="line"> &#125; CPU_state;</div></pre></td></tr></table></figure>
<p>这里我觉得每次编译运行都要自动 commit 嫌烦就手抽把 Makefile 改了，改成手动提交。。 但是昨晚 PA1 感觉提交记录不太够，还是改回来吧。。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"> $(BINARY): $(OBJS)</div><div class="line"><span class="deletion">-	$(call git_commit, "compile")</span></div><div class="line"> 	@echo + LD $@</div><div class="line"> 	@$(LD) -O2 -o $@ $^ -lSDL2 -lreadline</div><div class="line"></div><div class="line"> run: $(BINARY)</div><div class="line"><span class="deletion">-	$(call git_commit, "run")</span></div><div class="line"> 	$(NEMU_EXEC)</div><div class="line"></div><div class="line"><span class="addition">+commit: $(BINARY)</span></div><div class="line"><span class="addition">+	$(call git_commit, "$(message)")</span></div><div class="line"><span class="addition">+</span></div><div class="line"> gdb: $(BINARY)</div><div class="line"><span class="deletion">-	$(call git_commit, "gdb")</span></div><div class="line"> 	gdb -s $(BINARY) --args $(NEMU_EXEC)</div></pre></td></tr></table></figure>
<p>对了，测试代码的时候觉得海量的输出和那个 -Werror 烦人的话可以像我一样改一下</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="deletion">-CFLAGS   += -O2 -MMD -Wall -Werror -ggdb $(INCLUDES)</span></div><div class="line"><span class="addition">+ifeq ($(debug), y)</span></div><div class="line"><span class="addition">+CFLAGS   = -O2 -MMD -Wall -ggdb -D MY_DEBUG $(INCLUDES)</span></div><div class="line"><span class="addition">+else ifeq ($(debug), n)</span></div><div class="line"><span class="addition">+CFLAGS   = -O2 -MMD -Wall -Werror $(INCLUDES)</span></div><div class="line"><span class="addition">+else</span></div><div class="line"><span class="addition">+CFLAGS   = -O2 -MMD -Wall -Werror -ggdb $(INCLUDES)</span></div><div class="line"><span class="addition">+endif</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+debug:</span></div><div class="line"><span class="addition">+	@echo $(CFLAGS)</span></div></pre></td></tr></table></figure>
<p>单步执行直接调用接口就好了</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+static int cmd_si(char *args)&#123;</span></div><div class="line"><span class="addition">+  int n;</span></div><div class="line"><span class="addition">+  if (args == NULL)</span></div><div class="line"><span class="addition">+ 	n = 1;</span></div><div class="line"><span class="addition">+  else</span></div><div class="line"><span class="addition">+	n = atoi(args);</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+  cpu_exec(n);</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+  return 0;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<p>打印寄存器直接 printf 输出</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">if (strcmp(args, "r") == 0)&#123;</div><div class="line"><span class="addition">+	char eip[9], eax[9], ebx[9], ecx[9], edx[9], esp[9], ebp[9], esi[9], edi[9];</span></div><div class="line"><span class="addition">+	sprintf(eip, "%08x", cpu.eip);</span></div><div class="line"><span class="addition">+	sprintf(eax, "%08x", cpu.eax);</span></div><div class="line"><span class="addition">+	sprintf(ebx, "%08x", cpu.ebx);</span></div><div class="line"><span class="addition">+	sprintf(ecx, "%08x", cpu.ecx);</span></div><div class="line"><span class="addition">+	sprintf(edx, "%08x", cpu.edx);</span></div><div class="line"><span class="addition">+	sprintf(esp, "%08x", cpu.esp);</span></div><div class="line"><span class="addition">+	sprintf(ebp, "%08x", cpu.ebp);</span></div><div class="line"><span class="addition">+	sprintf(esi, "%08x", cpu.esi);</span></div><div class="line"><span class="addition">+	sprintf(edi, "%08x", cpu.edi);</span></div><div class="line"><span class="addition">+	printf("%%eip: 0x%s\n", eip);</span></div><div class="line"><span class="addition">+	printf("%%eax: 0x%s\n", eax);</span></div><div class="line"><span class="addition">+	printf("%%ebx: 0x%s\n", ebx);</span></div><div class="line"><span class="addition">+	printf("%%ecx: 0x%s\n", ecx);</span></div><div class="line"><span class="addition">+	printf("%%edx: 0x%s\n", edx);</span></div><div class="line"><span class="addition">+	printf("%%esp: 0x%s\n", esp);</span></div><div class="line"><span class="addition">+	printf("%%ebp: 0x%s\n", ebp);</span></div><div class="line"><span class="addition">+	printf("%%esi: 0x%s\n", esi);</span></div><div class="line"><span class="addition">+	printf("%%edi: 0x%s\n", edi);</span></div><div class="line"><span class="addition">+  &#125;</span></div></pre></td></tr></table></figure>
<p>扫描内存这里出了问题，我调用访问内存的接口，访问到的数据最多只能访问四个，应该是误用了指针，尝试无果，用了取巧的办法，绕过接口直接对pmem操作，就很虚… 忽然想起我实现了表达式求值可以把地址换成表达式了</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+static int cmd_x(char *args)&#123;</span></div><div class="line"><span class="addition">+  // parse args</span></div><div class="line"><span class="addition">+  Assert(args != NULL, "too few argument");</span></div><div class="line"><span class="addition">+  char *sLen = strtok(args, " ");</span></div><div class="line"><span class="addition">+  Assert(sLen != NULL, "too few argument");</span></div><div class="line"><span class="addition">+  char *sAddr = strtok(NULL, " ");</span></div><div class="line"><span class="addition">+  Assert(sAddr != NULL, "too few argument");</span></div><div class="line"><span class="addition">+  Assert(strtok(NULL, " ") == NULL, "too many argument");</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+  // convert</span></div><div class="line"><span class="addition">+  int len = atoi(sLen);</span></div><div class="line"><span class="addition">+  vaddr_t nAddr;</span></div><div class="line"><span class="addition">+  sscanf(sAddr + 2, "%x", &amp;nAddr);</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+  // print</span></div><div class="line"><span class="addition">+  int i;</span></div><div class="line"><span class="addition">+  for (i = 0; i &lt; len; i+=4)&#123;</span></div><div class="line"><span class="addition">+	if (len - i &lt; 4)&#123;</span></div><div class="line"><span class="addition">+		printf("0x%07x: ", nAddr + i);</span></div><div class="line"><span class="addition">+		int k;</span></div><div class="line"><span class="addition">+		for (k = 0; k &lt; len - i; k++)&#123;</span></div><div class="line"><span class="addition">+			printf("0x%02x ", pmem[nAddr+i+k]);</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+		printf("\n");</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+	else&#123;</span></div><div class="line"><span class="addition">+		printf("0x%07x: 0x%02x 0x%02x 0x%02x 0x%02x\n", nAddr + i, pmem[nAddr+i], pmem[nAddr+i+1], pmem[nAddr+i+2], pmem[nAddr+i+3]);</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+  &#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+  return 0;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<ul>
<li><h2 id="表达式求值"><a href="#表达式求值" class="headerlink" title="表达式求值"></a>表达式求值</h2>首先是 token 的匹配，这里我想用正向预查（？！pattern），费尽力气没有找到C有这样的表达，然后注意到那句提示 pay attention，感觉好坑啊，真的勇士，脚踩过无数的坑…</li>
</ul>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"> static struct rule &#123;</div><div class="line">@@ -22,9 +32,25 @@ static struct rule &#123;</div><div class="line">    * Pay attention to the precedence level of different rules.</div><div class="line">    */</div><div class="line"></div><div class="line"><span class="deletion">-  &#123;" +", TK_NOTYPE&#125;,    // spaces</span></div><div class="line"><span class="deletion">-  &#123;"\\+", '+'&#125;,         // plus</span></div><div class="line"><span class="deletion">-  &#123;"==", TK_EQ&#125;         // equal</span></div><div class="line"><span class="addition">+  &#123;"^( +)", TK_NOTYPE&#125;,    	// spaces</span></div><div class="line"><span class="addition">+  &#123;"^(==)", TK_EQ&#125;,        	// equal</span></div><div class="line"><span class="addition">+  &#123;"^(!=)", TK_NEQ&#125;,		// not equal</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+  &#123;"^(\\+)", '+'&#125;,         // plus</span></div><div class="line"><span class="addition">+  &#123;"^(-)", '-'&#125;,         	// sub or neg</span></div><div class="line"><span class="addition">+  &#123;"^(\\*)", '*'&#125;,         // multi or inner</span></div><div class="line"><span class="addition">+  &#123;"^(/)", '/'&#125;,         	// div</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+  &#123;"^(0x[0-9a-fA-F]+)", TK_HEXADECIMAL&#125;,	// hexadecimal numbers</span></div><div class="line"><span class="addition">+  &#123;"^(0|[1-9][0-9]*)", TK_DECIMAL&#125;,		// decimal numbers</span></div><div class="line"><span class="addition">+  &#123;"^(\\$e(ax|bx|cx|dx|sp|bp|si|di|ip))", TK_REGNAME&#125;, 		// reg name</span></div><div class="line"><span class="addition">+  &#123;"^(,)", TK_COMMA&#125;,			// comma</span></div><div class="line"><span class="addition">+  &#123;"^(\\()", TK_OPEN_PAREN&#125;,	// open paren</span></div><div class="line"><span class="addition">+  &#123;"^(\\))", TK_CLOSE_PAREN&#125;,	// close paren</span></div><div class="line"><span class="addition">+  &#123;"^(&amp;&amp;)", TK_LOGIC_AND&#125;, 	// logic and</span></div><div class="line"><span class="addition">+  &#123;"^[|]&#123;2&#125;", TK_LOGIC_OR&#125;, 		//logic or</span></div><div class="line"><span class="addition">+  &#123;"^(!)", TK_LOGIC_NOT&#125;,		// logic not</span></div><div class="line"><span class="addition">+  // C has not (?!pattern), em...</span></div><div class="line"> &#125;;</div></pre></td></tr></table></figure>
<p>这样匹配后把那个判断 position 去掉了，感觉应该会优化一些</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="deletion">-      if (regexec(&amp;re[i], e + position, 1, &amp;pmatch, 0) == 0 &amp;&amp; pmatch.rm_so == 0) &#123;</span></div><div class="line"><span class="addition">+      if (regexec(&amp;re[i], e + position, 1, &amp;pmatch, 0) == 0) &#123;</span></div></pre></td></tr></table></figure>
<p>然后是将 匹配到的token信息 写入 tokens 数组，有一些token需要特殊处理（空格不用写入，数字和寄存器要写入更详细的信息）</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div></pre></td><td class="code"><pre><div class="line">         /* TODO: Now a new token is recognized with rules[i]. Add codes</div><div class="line">          * to record the token in the array `tokens'. For certain types</div><div class="line">@@ -80,9 +110,45 @@ static bool make_token(char *e) &#123;</div><div class="line">          */</div><div class="line"></div><div class="line">         switch (rules[i].token_type) &#123;</div><div class="line"><span class="deletion">-          default: TODO();</span></div><div class="line"><span class="deletion">-        &#125;</span></div><div class="line"><span class="addition">+		  	case TK_DECIMAL:</span></div><div class="line"><span class="addition">+			case TK_HEXADECIMAL:</span></div><div class="line"><span class="addition">+			case TK_REGNAME:</span></div><div class="line"><span class="addition">+				if (substr_len &gt; 31)</span></div><div class="line"><span class="addition">+					panic("value too long");</span></div><div class="line"><span class="addition">+				strncpy(tokens[nr_token].str, substr_start, substr_len);</span></div><div class="line"><span class="addition">+				tokens[nr_token].str[substr_len] = '\0';</span></div><div class="line"><span class="addition">+				tokens[nr_token].type = rules[i].token_type;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			case TK_NOTYPE:</span></div><div class="line"><span class="addition">+				continue;</span></div><div class="line"><span class="addition">+		  	case '-':</span></div><div class="line"><span class="addition">+				if (nr_token == 0 || check_negtive_prefixx(nr_token-1))&#123;</span></div><div class="line"><span class="addition">+					tokens[nr_token].type = TK_NEGTIVE;</span></div><div class="line"><span class="addition">+				#ifdef MY_DEBUG</span></div><div class="line"><span class="addition">+					Log("negtive");</span></div><div class="line"><span class="addition">+				#endif</span></div><div class="line"><span class="addition">+				&#125;</span></div><div class="line"><span class="addition">+				else&#123;</span></div><div class="line"><span class="addition">+					tokens[nr_token].type = rules[i].token_type;</span></div><div class="line"><span class="addition">+				#ifdef MY_DEBUG</span></div><div class="line"><span class="addition">+					Log("sub");</span></div><div class="line"><span class="addition">+				#endif</span></div><div class="line"><span class="addition">+				&#125;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			case '*':</span></div><div class="line"><span class="addition">+				if (nr_token == 0 || check_inner_prefixx(nr_token-1))&#123;</span></div><div class="line"><span class="addition">+					tokens[nr_token].type = TK_INNER;</span></div><div class="line"><span class="addition">+					break;</span></div><div class="line"><span class="addition">+				&#125;</span></div><div class="line"><span class="addition">+				else&#123;</span></div><div class="line"><span class="addition">+					tokens[nr_token].type = rules[i].token_type;;</span></div><div class="line"><span class="addition">+					break;</span></div><div class="line"><span class="addition">+				&#125;</span></div><div class="line"><span class="addition">+          	default:</span></div><div class="line"><span class="addition">+				 tokens[nr_token].type = rules[i].token_type;</span></div><div class="line"><span class="addition">+       &#125;</span></div></pre></td></tr></table></figure>
<p>检查是否是 ‘(‘ expression ‘)’ 的形式</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+// check open_paren &amp; close_paren</span></div><div class="line"><span class="addition">+bool check_parentheses(int p, int q)&#123;</span></div><div class="line"><span class="addition">+	if (tokens[p].type == TK_OPEN_PAREN &amp;&amp; tokens[q].type == TK_CLOSE_PAREN)&#123;</span></div><div class="line"><span class="addition">+		p++;</span></div><div class="line"><span class="addition">+		while (p &lt; q)&#123;</span></div><div class="line"><span class="addition">+			if (tokens[p].type == TK_CLOSE_PAREN)</span></div><div class="line"><span class="addition">+				return false;</span></div><div class="line"><span class="addition">+			p++;</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+		return true;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+	else</span></div><div class="line"><span class="addition">+		return false;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<p>检查 ‘*’ 是否匹配 指针解引用</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+bool check_inner_prefixx(int t)&#123;</span></div><div class="line"><span class="addition">+	int type = tokens[t].type;</span></div><div class="line"><span class="addition">+	if (type == '+' || type == '-' || type == '*' || type == TK_INNER || type == '/' || type == TK_NEGTIVE || type == TK_OPEN_PAREN || type == TK_COMMA || type == TK_EQ)</span></div><div class="line"><span class="addition">+		return true;</span></div><div class="line"><span class="addition">+	else</span></div><div class="line"><span class="addition">+		return false;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<p>检查 ‘-‘ 是否匹配 负号</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+bool check_negtive_prefixx(int t)&#123;</span></div><div class="line"><span class="addition">+	int type = tokens[t].type;</span></div><div class="line"><span class="addition">+	if (type == '+' || type == '-' || type == '*' || type == TK_INNER || type == '/' || type == TK_NEGTIVE || type == TK_OPEN_PAREN || type == TK_COMMA || type == TK_EQ)</span></div><div class="line"><span class="addition">+		 return true;</span></div><div class="line"><span class="addition">+	else</span></div><div class="line"><span class="addition">+		return false;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<p>将不可能的 dominant 排除掉</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+bool check_domi_operate(int t)&#123;</span></div><div class="line"><span class="addition">+	int type = tokens[t].type;</span></div><div class="line"><span class="addition">+	if (type == '+' || type == '-' || type == '*' || type == TK_INNER || type == '/' || type == TK_NEGTIVE || type == TK_COMMA || type == TK_EQ || type == TK_NEQ || type == TK_LOGIC_AND || type == TK_LOGIC_OR || type == TK_LOGIC_NOT)</span></div><div class="line"><span class="addition">+		return true;</span></div><div class="line"><span class="addition">+	else</span></div><div class="line"><span class="addition">+		return false;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<p>获取 dominant 以及 表达式求值，匹配最低的优先级，也便于将来拓展</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div><div class="line">93</div><div class="line">94</div><div class="line">95</div><div class="line">96</div><div class="line">97</div><div class="line">98</div><div class="line">99</div><div class="line">100</div><div class="line">101</div><div class="line">102</div><div class="line">103</div><div class="line">104</div><div class="line">105</div><div class="line">106</div><div class="line">107</div><div class="line">108</div><div class="line">109</div><div class="line">110</div><div class="line">111</div><div class="line">112</div><div class="line">113</div><div class="line">114</div><div class="line">115</div><div class="line">116</div><div class="line">117</div><div class="line">118</div><div class="line">119</div><div class="line">120</div><div class="line">121</div><div class="line">122</div><div class="line">123</div><div class="line">124</div><div class="line">125</div><div class="line">126</div><div class="line">127</div><div class="line">128</div><div class="line">129</div><div class="line">130</div><div class="line">131</div><div class="line">132</div><div class="line">133</div><div class="line">134</div><div class="line">135</div><div class="line">136</div><div class="line">137</div><div class="line">138</div><div class="line">139</div><div class="line">140</div><div class="line">141</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+int get_dominant(int p, int q)&#123;</span></div><div class="line"><span class="addition">+	int domi = -1;</span></div><div class="line"><span class="addition">+	int min_level = 15;</span></div><div class="line"><span class="addition">+	int level;</span></div><div class="line"><span class="addition">+	int cur;</span></div><div class="line"><span class="addition">+	for (cur = p; cur &lt;= q; cur++)&#123;</span></div><div class="line"><span class="addition">+		// jump over bracks</span></div><div class="line"><span class="addition">+		if (tokens[cur].type == TK_OPEN_PAREN)&#123;</span></div><div class="line"><span class="addition">+			cur++;</span></div><div class="line"><span class="addition">+			while (tokens[cur].type != TK_CLOSE_PAREN)</span></div><div class="line"><span class="addition">+				cur++;</span></div><div class="line"><span class="addition">+			cur++;</span></div><div class="line"><span class="addition">+			if (cur &gt; q)</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+		// jump non_diminant</span></div><div class="line"><span class="addition">+		if (!check_domi_operate(cur))</span></div><div class="line"><span class="addition">+			continue;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+		switch (tokens[cur].type)&#123;</span></div><div class="line"><span class="addition">+			case TK_NEGTIVE:</span></div><div class="line"><span class="addition">+			case TK_INNER:</span></div><div class="line"><span class="addition">+			case TK_LOGIC_NOT:</span></div><div class="line"><span class="addition">+				level = 9;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			case '*':</span></div><div class="line"><span class="addition">+			case '/':</span></div><div class="line"><span class="addition">+				level = 8;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			case '+':</span></div><div class="line"><span class="addition">+			case '-':</span></div><div class="line"><span class="addition">+				level = 7;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			case TK_EQ:</span></div><div class="line"><span class="addition">+			case TK_NEQ:</span></div><div class="line"><span class="addition">+				level = 6;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			case TK_LOGIC_AND:</span></div><div class="line"><span class="addition">+				level = 5;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			case TK_LOGIC_OR:</span></div><div class="line"><span class="addition">+				level = 4;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			case TK_COMMA:</span></div><div class="line"><span class="addition">+				level = 1;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			default:</span></div><div class="line"><span class="addition">+				assert(0);</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+		if (level &lt;= min_level)&#123;</span></div><div class="line"><span class="addition">+			min_level = level;</span></div><div class="line"><span class="addition">+			domi = cur;</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+#ifdef MY_DEBUG</span></div><div class="line"><span class="addition">+	Log("hit level %d, %d - %d", min_level, p, q);</span></div><div class="line"><span class="addition">+#endif</span></div><div class="line"><span class="addition">+	Assert(domi != -1, "cannot hit dominant");</span></div><div class="line"><span class="addition">+	return domi;</span></div><div class="line"><span class="addition">+&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+uint32_t eval(int p, int q)&#123;</span></div><div class="line"><span class="addition">+#ifdef MY_DEBUG</span></div><div class="line"><span class="addition">+	Log("eval %d - %d", p, q);</span></div><div class="line"><span class="addition">+#endif</span></div><div class="line"><span class="addition">+	if (p &gt; q)&#123;</span></div><div class="line"><span class="addition">+		panic("Bad expression");</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+	else if (p == q)&#123;</span></div><div class="line"><span class="addition">+		uint32_t n = 0;</span></div><div class="line"><span class="addition">+		if (tokens[p].type == TK_DECIMAL)</span></div><div class="line"><span class="addition">+			sscanf(tokens[p].str, "%d", &amp;n);</span></div><div class="line"><span class="addition">+		else if (tokens[p].type == TK_HEXADECIMAL)</span></div><div class="line"><span class="addition">+			sscanf(tokens[p].str + 2, "%x", &amp;n);</span></div><div class="line"><span class="addition">+		else if (tokens[p].type == TK_REGNAME)&#123;</span></div><div class="line"><span class="addition">+			if (strcmp(tokens[p].str + 2, "ax") == 0)</span></div><div class="line"><span class="addition">+				return cpu.eax;</span></div><div class="line"><span class="addition">+			else if (strcmp(tokens[p].str + 2, "bx") == 0)</span></div><div class="line"><span class="addition">+				return cpu.ebx;</span></div><div class="line"><span class="addition">+			else if (strcmp(tokens[p].str + 2, "cx") == 0)</span></div><div class="line"><span class="addition">+				return cpu.ecx;</span></div><div class="line"><span class="addition">+			else if (strcmp(tokens[p].str + 2, "dx") == 0)</span></div><div class="line"><span class="addition">+				return cpu.edx;</span></div><div class="line"><span class="addition">+			else if (strcmp(tokens[p].str + 2, "sp") == 0)</span></div><div class="line"><span class="addition">+				return cpu.esp;</span></div><div class="line"><span class="addition">+			else if (strcmp(tokens[p].str + 2, "bp") == 0)</span></div><div class="line"><span class="addition">+				return cpu.ebp;</span></div><div class="line"><span class="addition">+			else if (strcmp(tokens[p].str + 2, "si") == 0)</span></div><div class="line"><span class="addition">+				return cpu.esi;</span></div><div class="line"><span class="addition">+			else if (strcmp(tokens[p].str + 2, "di") == 0)</span></div><div class="line"><span class="addition">+				return cpu.edi;</span></div><div class="line"><span class="addition">+			else if (strcmp(tokens[p].str + 2, "ip") == 0)</span></div><div class="line"><span class="addition">+				return cpu.eip;</span></div><div class="line"><span class="addition">+			else</span></div><div class="line"><span class="addition">+				panic("no such register");</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+		else</span></div><div class="line"><span class="addition">+			assert(0);</span></div><div class="line"><span class="addition">+		return n;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+	else if (check_parentheses(p, q))&#123;</span></div><div class="line"><span class="addition">+		return eval(p+1, q-1);</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+	else&#123;</span></div><div class="line"><span class="addition">+		int domi = get_dominant(p, q);</span></div><div class="line"><span class="addition">+		if (tokens[domi].type == TK_NEGTIVE)</span></div><div class="line"><span class="addition">+			return -1 * eval(domi+1, q);</span></div><div class="line"><span class="addition">+		if (tokens[domi].type == TK_INNER)</span></div><div class="line"><span class="addition">+			return pmem[eval(domi+1, q)];</span></div><div class="line"><span class="addition">+		if (tokens[domi].type == TK_LOGIC_NOT)</span></div><div class="line"><span class="addition">+			return !(eval(domi+1, q));</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+		int val1 = eval(p, domi-1);</span></div><div class="line"><span class="addition">+		int val2 = eval(domi+1, q);</span></div><div class="line"><span class="addition">+		switch (tokens[domi].type)&#123;</span></div><div class="line"><span class="addition">+			case '+':</span></div><div class="line"><span class="addition">+				return val1 + val2;</span></div><div class="line"><span class="addition">+			case '-':</span></div><div class="line"><span class="addition">+				return val1 - val2;</span></div><div class="line"><span class="addition">+			case '*':</span></div><div class="line"><span class="addition">+				return val1 * val2;</span></div><div class="line"><span class="addition">+			case '/':</span></div><div class="line"><span class="addition">+				return val1 / val2;</span></div><div class="line"><span class="addition">+			case TK_EQ:</span></div><div class="line"><span class="addition">+				return val1 == val2;</span></div><div class="line"><span class="addition">+			case TK_NEQ:</span></div><div class="line"><span class="addition">+				return val1 != val2;</span></div><div class="line"><span class="addition">+			case TK_LOGIC_AND:</span></div><div class="line"><span class="addition">+				return val1 &amp;&amp; val2;</span></div><div class="line"><span class="addition">+			case TK_LOGIC_OR:</span></div><div class="line"><span class="addition">+				return val1 || val2;</span></div><div class="line"><span class="addition">+			case TK_COMMA:</span></div><div class="line"><span class="addition">+				return val2;</span></div><div class="line"><span class="addition">+			default:</span></div><div class="line"><span class="addition">+				assert(0);</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<p>最后当然要测试一下，我真的觉得我需要一个单元测试框架了，这样好累</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+void expr_test()&#123;</span></div><div class="line"><span class="addition">+	bool success = false;</span></div><div class="line"><span class="addition">+#define N 27</span></div><div class="line"><span class="addition">+	char es[][N] = 	&#123;	"3+2", "3-2", "3*2", "3/2",			// base test</span></div><div class="line"><span class="addition">+						"3==3", "3==2", "3!=3", "3!=2",</span></div><div class="line"><span class="addition">+						"1&amp;&amp;0", "1&amp;&amp;1", "1||1", "1||0",</span></div><div class="line"><span class="addition">+						"!3", "!0", "32", "0", "0x00", "0xff",</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+						"(3+2)", "(-2*3)", "-(3+4)-(-2*3)", "3+2, 3*4",</span></div><div class="line"><span class="addition">+					    "*(0x100000)", "$eip", "*$eip", "*($eip + 1)", "*($eip + 2)",</span></div><div class="line"><span class="addition">+					&#125;;</span></div><div class="line"><span class="addition">+	int res[N] 	= 	&#123;	5, 1, 6, 1,</span></div><div class="line"><span class="addition">+		   				1, 0, 0, 1,</span></div><div class="line"><span class="addition">+						0, 1, 1, 1,</span></div><div class="line"><span class="addition">+						0, 1, 32, 0, 0, 255,</span></div><div class="line"></div><div class="line"><span class="deletion">-  return 0;</span></div><div class="line"><span class="addition">+						5, -6, -1, 12,</span></div><div class="line"><span class="addition">+						184, 1048576, 184, 52, 18,</span></div><div class="line"><span class="addition">+					&#125;;</span></div><div class="line"><span class="addition">+	int i;</span></div><div class="line"><span class="addition">+	for (i = 0; i &lt; N; i++)&#123;</span></div><div class="line"><span class="addition">+		Log("test: %s = %d",es[i], res[i]);</span></div><div class="line"><span class="addition">+		int nres = expr(es[i], &amp;success);</span></div><div class="line"><span class="addition">+		Assert(nres == res[i], "expr result: %d", nres);</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"> &#125;</div></pre></td></tr></table></figure>
<ul>
<li><h2 id="监视点"><a href="#监视点" class="headerlink" title="监视点"></a>监视点</h2></li>
</ul>
<p>设计接口，设置一个新的监视点时，从 free_ 删掉一个加入 head，删除监视点时相反。</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+WP * new_wp(char *str, int value)&#123;</span></div><div class="line"><span class="addition">+	if (free_ != NULL)&#123;</span></div><div class="line"><span class="addition">+		WP *t = free_;</span></div><div class="line"><span class="addition">+		free_ = free_-&gt;next;</span></div><div class="line"><span class="addition">+		t-&gt;next = NULL;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+		if (strlen(str) &gt; 31)</span></div><div class="line"><span class="addition">+			panic("expression too long");</span></div><div class="line"></div><div class="line"><span class="addition">+		strcpy(t-&gt;str, str);</span></div><div class="line"><span class="addition">+		t-&gt;value = value;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+		if (head == NULL)&#123;</span></div><div class="line"><span class="addition">+			head = t;</span></div><div class="line"><span class="addition">+			t-&gt;next = NULL;</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+		else&#123;</span></div><div class="line"><span class="addition">+			t-&gt;next = head;</span></div><div class="line"><span class="addition">+			head = t;</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+		return t;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+	else&#123;</span></div><div class="line"><span class="addition">+		assert(0);</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+void free_wp(int id)&#123;</span></div><div class="line"><span class="addition">+	WP *t = head;</span></div><div class="line"><span class="addition">+	WP *r = NULL;</span></div><div class="line"><span class="addition">+	if (t-&gt;NO == id)&#123;</span></div><div class="line"><span class="addition">+		r = t;</span></div><div class="line"><span class="addition">+		head = t-&gt;next;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+	else&#123;</span></div><div class="line"><span class="addition">+		while (t-&gt;next != NULL)&#123;</span></div><div class="line"><span class="addition">+			if (t-&gt;next-&gt;NO == id)&#123;</span></div><div class="line"><span class="addition">+				r = t-&gt;next;</span></div><div class="line"><span class="addition">+				t-&gt;next = t-&gt;next-&gt;next;</span></div><div class="line"><span class="addition">+				break;</span></div><div class="line"><span class="addition">+			&#125;</span></div><div class="line"><span class="addition">+			t = t-&gt;next;</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+	if (r == NULL)</span></div><div class="line"><span class="addition">+		panic("couldnt found wp %d", id);</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+	r-&gt;value = 0;</span></div><div class="line"><span class="addition">+	if (free_ == NULL)&#123;</span></div><div class="line"><span class="addition">+		free_ = r;</span></div><div class="line"><span class="addition">+		r-&gt;next = NULL;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+	else&#123;</span></div><div class="line"><span class="addition">+		r-&gt;next = free_;</span></div><div class="line"><span class="addition">+		free_ = r;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<p>打印监视点只需要遍历 head</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+void show_wp()&#123;</span></div><div class="line"><span class="addition">+	WP *t = head;</span></div><div class="line"><span class="addition">+	while (t != NULL)&#123;</span></div><div class="line"><span class="addition">+		printf("wp [%d], %s: %d\n", t-&gt;NO, t-&gt;str, t-&gt;value);</span></div><div class="line"><span class="addition">+		t = t-&gt;next;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+void show_free()&#123;</span></div><div class="line"><span class="addition">+	WP *t = free_;</span></div><div class="line"><span class="addition">+	while (t != NULL)&#123;</span></div><div class="line"><span class="addition">+		printf("wp [%d], %s: %d\n", t-&gt;NO, t-&gt;str, t-&gt;value);</span></div><div class="line"><span class="addition">+		t = t-&gt;next;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<p>检查监视点的值是否有变化，检查所有有变化的监视点</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">     /* TODO: check watchpoints here. */</div><div class="line"><span class="deletion">-</span></div><div class="line"><span class="addition">+	WP *t = check_wp(NULL);</span></div><div class="line"><span class="addition">+	while (t != NULL)&#123;</span></div><div class="line"><span class="addition">+		if (nemu_state != NEMU_END)</span></div><div class="line"><span class="addition">+			nemu_state = NEMU_STOP;</span></div><div class="line"><span class="addition">+		printf("[-] wp [%d]:(%s) has changed, its value is %d\n", t-&gt;NO, t-&gt;str, t-&gt;value);</span></div><div class="line"><span class="addition">+		t = check_wp(t);</span></div><div class="line"><span class="addition">+	&#125;</span></div></pre></td></tr></table></figure>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+WP * check_wp(WP *w)&#123;</span></div><div class="line"><span class="addition">+	if (w == NULL)&#123;</span></div><div class="line"><span class="addition">+		w = head;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+	while (w != NULL)&#123;</span></div><div class="line"><span class="addition">+		bool success;</span></div><div class="line"><span class="addition">+		int res = expr(w-&gt;str, &amp;success);</span></div><div class="line"><span class="addition">+		if (res != w-&gt;value)&#123;</span></div><div class="line"><span class="addition">+			w-&gt;value = res;</span></div><div class="line"><span class="addition">+			return w;</span></div><div class="line"><span class="addition">+		&#125;</span></div><div class="line"><span class="addition">+		w = w-&gt;next;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+	return NULL;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<p>设置监视点和删除监视点</p>
<figure class="highlight diff"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="addition">+static int cmd_w(char *args)&#123;</span></div><div class="line"><span class="addition">+	if (args == NULL)&#123;</span></div><div class="line"><span class="addition">+		cmd_help("w");</span></div><div class="line"><span class="addition">+		return 0;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+	char *tok1 = strtok(args, "=");</span></div><div class="line"><span class="addition">+	char *tok2 = strtok(NULL, "=");</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+	bool success;</span></div><div class="line"><span class="addition">+	int res;</span></div><div class="line"><span class="addition">+	if (tok2 == NULL)</span></div><div class="line"><span class="addition">+		res = expr(tok1, &amp;success);</span></div><div class="line"><span class="addition">+	else&#123;</span></div><div class="line"><span class="addition">+		res = expr(tok2, &amp;success);</span></div><div class="line"><span class="addition">+		*(tok2-1) = '\0';</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+	WP *w = new_wp(tok1, res);</span></div><div class="line"><span class="addition">+   	printf("[-] set wp [%d], %s: %d\n", w-&gt;NO, w-&gt;str, w-&gt;value);</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+	return 0;</span></div><div class="line"><span class="addition">+&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+static int cmd_d(char *args)&#123;</span></div><div class="line"><span class="addition">+	if (args == NULL)&#123;</span></div><div class="line"><span class="addition">+		cmd_help("d");</span></div><div class="line"><span class="addition">+		return 0;</span></div><div class="line"><span class="addition">+	&#125;</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+	int id = 0;</span></div><div class="line"><span class="addition">+	sscanf(args, "%d", &amp;id);</span></div><div class="line"><span class="addition">+	free_wp(id);</span></div><div class="line"><span class="addition">+</span></div><div class="line"><span class="addition">+	return 0;</span></div><div class="line"><span class="addition">+&#125;</span></div></pre></td></tr></table></figure>
<h1 id="熟悉i386手册"><a href="#熟悉i386手册" class="headerlink" title="熟悉i386手册"></a>熟悉i386手册</h1><h2 id="必答题"><a href="#必答题" class="headerlink" title="必答题"></a>必答题</h2><blockquote>
<p>查阅i386手册 理解了科学查阅手册的方法之后, 请你尝试在i386手册中查阅以下问题所在的位置, 把需要阅读的范围写到你的实验报告里面:</p>
</blockquote>
<pre><code>EFLAGS寄存器中的CF位是什么意思?        x86结构 carry flag
ModR/M字节是什么?                    指令格式部分
mov指令的具体格式是怎么样的?          指令集细节
</code></pre><blockquote>
<p>shell命令 完成PA1的内容之后, nemu目录下的所有.c和.h和文件总共有多少行代码? 你是使用什么命令得到这个结果的? 和框架代码相比, 你在PA1中编写了多少行代码? (Hint: 使用 git checkout 可以回到”过去”, 具体使用方法请查阅 man git-checkout ) 你可以把这条命令写入 Makefile 中, 随着实验进度的推进, 你可以很方便地统计工程的代码行数, 例如敲入 make count 就会自动运行统计代码行数的命令.</p>
</blockquote>
<pre><code>4025行
find . -name *.[ch] | xargs wc -l
15479 - 14931行
git checkout pa0 &amp;&amp; find . | xargs wc -l
git checkout pa1 &amp;&amp; find . | xargs wc -l
</code></pre><blockquote>
<p>再来个难一点的, 除去空行之外, nemu目录下的所有.c和.h文件总共有多少行代码?</p>
</blockquote>
<pre><code>3321
find . -name *.[ch] | xargs grep -v &quot;^$&quot; | wc -l
</code></pre><blockquote>
<p>使用man 打开工程目录下的 Makefile 文件, 你会在 CFLAGS 变量中看到gcc的一些编译选项. 请解释gcc中的 -Wall 和 -Werror 有什么作用? 为什么要使用 -Wall 和 -Werror ?</p>
</blockquote>
<pre><code>W（warning），-Wall（显示所有警告），-Werror（将所有警告视为error）
</code></pre><h1 id="思考题"><a href="#思考题" class="headerlink" title="思考题"></a>思考题</h1><blockquote>
<p>假设你在Windows中使用Virtualbox安装了一个GNU/Linux虚拟机, 然后在虚拟机中完成PA, 通过NEMU运行Hello World程序. 在这样的情况下, 尝试画出相应的层次图.</p>
</blockquote>
<pre><code>计算机硬件 -&gt; 操作系统（windows） -&gt; 软件（virtualbox） -&gt; 虚拟硬件（虚拟硬盘等） -&gt; 虚拟操作系统（linux） -&gt; 模拟器软件（NEMU） -&gt; 模拟器硬件（内存，寄存器等） -&gt; 开放接口（操作系统） -&gt; 用户程序（hello world）
</code></pre><blockquote>
<p>程序从哪里开始？</p>
</blockquote>
<pre><code>main 函数，main 函数是程序的入口地址。
</code></pre><blockquote>
<p>opcode_table 到底是个什么类型的数组?</p>
</blockquote>
<pre><code>opcode_table 是结构体数组
</code></pre><blockquote>
<p>在 cmd_c() 函数中, 调用 cpu_exec() 的时候传入了参数 -1 , 你知道这是什么意思吗?</p>
</blockquote>
<pre><code>-1 传给了一个无符号数 uint64，就是最大的数字，n 是执行次数，所以 continue 将依次执行完所有指令。（果然温故而知新啊，古人诚不欺我，写报告的时候才突然想到的）
</code></pre><blockquote>
<p>谁来指示程序的结束?</p>
</blockquote>
<pre><code>应该是由指令集确定的吧
</code></pre><blockquote>
<p>体会： 从表达式求值窥探编译器</p>
</blockquote>
<pre><code>应该是类似的词法分析，然后建立符号表什么的，最后编译链接成二进制。

框架代码中定义 wp_pool 等变量的时候使用了关键字 static , static 在此处的含义是什么? 为什么要在此处使用它?
</code></pre><p>这里使用 static 是为了限制变量作用域到只能本文件引用，一般的全局变量可以被其他文件引用。</p>
<blockquote>
<p>以下问题涉及到指令，暂时无法理解，可以之后补充</p>
</blockquote>
<pre><code>一点也不能长?

我们知道 int3 指令不带任何操作数, 操作码为1个字节, 因此指令的长度是1个字节. 这是必须的吗? 假设有一种IA-32体系结构的变种my-IA-32, 除了 int3 指令的长度变成了2个字节之外, 其余指令和IA-32相同. 在my-IA-32中, 文章中的断点机制还可以正常工作吗? 为什么?

&quot;随心所欲&quot;的断点

如果把断点设置在指令的非首字节(中间或末尾), 会发生什么? 你可以在GDB中尝试一下, 然后思考并解释其中的缘由.

NEMU的前世今生

你已经对NEMU的工作方式有所了解了. 事实上在NEMU诞生之前, NEMU曾经有一段时间并不叫NEMU, 而是叫NDB(NJU Debugger), 后来由于某种原因才改名为NEMU. 如果你想知道这一段史前的秘密, 你首先需要了解这样一个问题: 模拟器(Emulator)和调试器(Debugger)有什么不同? 更具体地, 和NEMU相比, GDB到底是如何调试程序的?
</code></pre><p>Over</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/code/" rel="tag"># code</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/pa0.html" rel="next" title="顺利的 PA0">
                <i class="fa fa-chevron-left"></i> 顺利的 PA0
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/PA-interface.html" rel="prev" title="PA - 接口相关">
                PA - 接口相关 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/yoshino.bmp"
                alt="kur0mi" />
            
              <p class="site-author-name" itemprop="name">kur0mi</p>
              <p class="site-description motion-element" itemprop="description">step by step</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">21</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">9</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">30</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          <div class="links-of-author motion-element">
            
              
                <span class="links-of-author-item">
                  <a href="https://github.com/kur0mi" target="_blank" title="GitHub">
                    
                      <i class="fa fa-fw fa-github"></i>GitHub</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://leetcode.com/kur0mi/" target="_blank" title="Leetcode">
                    
                      <i class="fa fa-fw fa-leetcode"></i>Leetcode</a>
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://www.codewars.com/users/Nightmare-O" target="_blank" title="Codewars">
                    
                      <i class="fa fa-fw fa-codewars"></i>Codewars</a>
                </span>
              
            
          </div>

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-inline">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.rexskz.info/" title="Rex" target="_blank">Rex</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://susers.github.io/" title="SUS" target="_blank">SUS</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://blog.imagemlt.xyz/" title="Image" target="_blank">Image</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://qrzbing.cn/" title="A-Lie-Z" target="_blank">A-Lie-Z</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://yuwenjie.cc/" title="于老板" target="_blank">于老板</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://primykq.top/" title="Primykq" target="_blank">Primykq</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://rayzhao1998.github.io/" title="SkyNet_Z" target="_blank">SkyNet_Z</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://addonedn.github.io/" title="AddOne" target="_blank">AddOne</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.d4rk7r4c3r.cn/" title="D4rk7r4c3r" target="_blank">D4rk7r4c3r</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://403forbidden.website/" title="foxwest" target="_blank">foxwest</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://ctf-wiki.github.io/ctf-wiki/#/" title="CTF wiki" target="_blank">CTF wiki</a>
                  </li>
                
              </ul>
            </div>
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#PA1-洞察世界的视点-简易调试器"><span class="nav-number">1.</span> <span class="nav-text">PA1 - 洞察世界的视点: 简易调试器</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#在开始愉快的PA之旅之前"><span class="nav-number">2.</span> <span class="nav-text">在开始愉快的PA之旅之前</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#RTFSC"><span class="nav-number">3.</span> <span class="nav-text">RTFSC</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#简易调试器"><span class="nav-number">4.</span> <span class="nav-text">简易调试器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本功能"><span class="nav-number">4.1.</span> <span class="nav-text">基本功能</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#表达式求值"><span class="nav-number">4.2.</span> <span class="nav-text">表达式求值</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#监视点"><span class="nav-number">4.3.</span> <span class="nav-text">监视点</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#熟悉i386手册"><span class="nav-number">5.</span> <span class="nav-text">熟悉i386手册</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#必答题"><span class="nav-number">5.1.</span> <span class="nav-text">必答题</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#思考题"><span class="nav-number">6.</span> <span class="nav-text">思考题</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <script async src="https://dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
<div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kur0mi</span>

  
</div>


  <div class="powered-by">
    <i class="fa fa-user-md"></i>
    <span id="busuanzi_container_site_uv">
      本站访客数:<span id="busuanzi_value_site_uv"></span> |
    </span>
  </div>
  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>








        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  


  











  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.3"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.3"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.3"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.3"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.3"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.3"></script>



  


  




	





  





  












  





  

  
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>


  
  

  

  

  

</body>
</html>
